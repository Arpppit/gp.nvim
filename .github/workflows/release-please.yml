on:
  workflow_run:
    workflows: ["docgen"]
    types:
      - completed

permissions:
  contents: write
  pull-requests: write

name: release-please

jobs:
  release-please:
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'refs/heads/main' }}
    steps:
      - uses: googleapis/release-please-action@v4
        id: release
        with:
          release-type: simple
      - name: Send to Discord
        if: ${{ steps.release.outputs.release_created }}
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          RELEASE_NOTES: ${{ steps.release.outputs.body }}
        run: |
          curl -H "Content-Type: application/json" -X POST -d '{
            "content": "New Release: ${{ steps.release.outputs.tag_name }}\n\n```markdown\n${{ steps.release.outputs.body }}\n```"
          }' $DISCORD_WEBHOOK_URL
